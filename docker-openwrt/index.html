<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
<title>在Docker 中运行 OpenWrt 旁路网关 - IMCM</title>
<meta name="description" content="&lt;span id=&#34;jinrishici-sentence&#34;&gt;正在加载今日诗词....&lt;/span&gt;
&lt;script src=&#34;https://sdk.jinrishici.com/v2/browser/jinrishici.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

<link type="text/css" rel="stylesheet" href="https://imcm.xyz/styles/main.css" media="screen" />
<link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" />
<link type="text/css" rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" />
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css" integrity="sha512-FwY1WVsm4UQgrOXt6kaQ53w83cOHa8fSvjFn/BvVOCYVPmkSR39k/xnU+8hht3zW6JL1TBd4C/aVQIAV58Cg6A==" crossorigin="anonymous" /> -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/atom-one-dark.min.css" integrity="sha512-Jlyabam8ztU2kOGN19fSzv1Go9nt9A43UA6vhmL1MPsQMeoPZd+p7pbmegAtyl8kulna0Cqwb7Pgj4adGTLCXA==" crossorigin="anonymous" />
<script type="text/javascript" src="https://imcm.xyz/media/scripts/jquery.js"></script>
<!-- <script type="text/javascript" src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js" integrity="sha512-tHQeqtcNWlZtEh8As/4MmZ5qpy0wj04svWFK7MIzLmUVIzaHXS8eod9OmHxyBL1UET5Rchvw7Ih4ZDv5JojZww==" crossorigin="anonymous"></script>



<script>
  hljs.initHighlightingOnLoad();
</script>

</head>

<body>
  <div class="layout">
    <div class="layout-header">

	<div class="layout-header-main">
		<div class="container">
			<div class="row justify-content-lg-center">
				<div class="col-12 col-lg-9">

					<div class="navbar">

						<div class="logo">
							<a href="https://imcm.xyz">
								<img class="logo" src="https://imcm.xyz/media/images/site_avatar.png?v=1608689898643"
									alt="">
							</a>
						</div>

						<div class="menu d-md-inline-block d-none">
							<ul class="layout-navigation-list">
								
								<li class="layout-navigation-item"><a title="首页"
										href="/">首页</a>
								</li>
								
								<li class="layout-navigation-item"><a title="归档"
										href="/archives">归档</a>
								</li>
								
								<li class="layout-navigation-item"><a title="标签"
										href="/tags">标签</a>
								</li>
								
								<li class="layout-navigation-item"><a title="关于"
										href="/about">关于</a>
								</li>
								
							</ul>
						</div>

						

						<div class="nav d-md-none d-inline-block">
							<div class="trigger">
								<i class="fa fa-bars layout-btn-toggle" aria-hidden="true"></i>
							</div>
						</div>

					</div>

				</div>
			</div>




		</div>
	</div>

</div>
    <div class="layout-collapse d-md-none">
	<div class="layout-collapse-main">
		<ul class="layout-collapse-list">
			
			<li class="layout-collapse-item"><a title="首页" href="/">首页</a></li>
			
			<li class="layout-collapse-item"><a title="归档" href="/archives">归档</a></li>
			
			<li class="layout-collapse-item"><a title="标签" href="/tags">标签</a></li>
			
			<li class="layout-collapse-item"><a title="关于" href="/about">关于</a></li>
			

		</ul>
	</div>
</div>

    <div class="layout-content">
      <div class="layout-content-main">
        <div class="container">
          <div class="row justify-content-lg-center">
            <div class="col-12 col-lg-9">
              <div class="layout-post">
                <div class="layout-post-body">
                  <div class="row">

                    <div class="col-12 col-lg-10">
                      <div class="layout-post-main m-right m-md-right">
                        <div class="layout-post-header">
                          <h1 class="layout-post-title">在Docker 中运行 OpenWrt 旁路网关</h1>
                          <div class="layout-post-meta">
                            <div class="item">
                               <a href="https://imcm.xyz/openwrt/" class="post--keyword"
                                data-title="openwrt" data-type="post_tag" data-term-id="39">openwrt</a>
                               <a href="https://imcm.xyz/docker/" class="post--keyword"
                                data-title="docker" data-type="post_tag" data-term-id="39">docker</a>
                              
                            </div>
                            <div class="item">
                              <span>2020-06-16</span>
                            </div>
                          </div>
                        </div>
                        <div class="layout-post-content">
                          <div class="layout-post-item">
                            
                            <p class="with-img"><img src="https://imcm.xyz/post-images/docker-openwrt.jpg"
                                class="attachment-full size-full wp-post-image" alt="在Docker 中运行 OpenWrt 旁路网关" /></p>
                            
                            <p>今天小苏为大家带来的是（咕很久的）在 Docker 中运行 OpenWrt 做旁路网关的教程~</p>
<!-- more -->
<p>本文转自： <a href="https://mlapp.cn/376.html">美丽应用</a></p>
<h3 id="场景1">场景1</h3>
<p>众所周知，OpenWrt 是面向嵌入型设备的 Linux 发行版，所以 OpenWrt 系统运行时的资源占用率会很低。而树莓派的硬件性能要比普通路由器要高很多。虽然树莓派在硬件配置上的绝对优势能让 OpenWrt 有更大的施展空间，但相应的，硬件上的优势也带来了资源的浪费（OpenWrt 在树莓派上正常运行时，资源占用率只有不到 1/10）。再加上 OpenWrt 的可扩展性不是很强，所以很多能在 Raspbian/Debian 上能做的事情在 OpenWrt 上往往无法实现。</p>
<p>所以，可不可以让 OpenWrt 与我们常用的系统共存呢？这样，我们可以享受到 OpenWrt 的功能，又可以让在我们常用的系统中完成一般性的 Linux 工作。</p>
<p>通过 Docker，完全可以。</p>
<h3 id="场景2">场景2</h3>
<p>OpenWrt 的功能固然强大，但是树莓派的板载网卡无线吞吐能力实在是无力吐槽，能否将现有路由器与树莓派结合使用，同时发挥现有路由器的信号优势与 OpenWrt 的软件优势呢？</p>
<p>通过旁路网关，完全可以。</p>
<h3 id="旁路网关">旁路网关</h3>
<p>那么，什么是旁路网关呢？</p>
<p>普通的路由器往往集无线信号转发、网关、DNS 服务器等角色为一身，其中的“网关”角色负责路由器内部数据的处理。但因为一般家用的路由器硬件性能很有限，在运行一些比较吃资源的应用（如酸酸乳、去广告等）时，几乎会占满所有硬件资源，导致路由器网络/系统不稳定等诸多问题。既然路由器的硬件性能有限，那可不可以把网关的重任交给硬件性能更好的设备去做，让路由器安安心心地做好它的老本行 – 无线转发呢？</p>
<p>完全可以。</p>
<p>所谓的旁路网关，就是在路由器之外的其他硬件设备上搭建一个网关环境，把路由器肩负的网关重任交给其他更适合的设备来做，同时，旁路网关处理完的结果会返回给路由器，由路由器继续进行无线转发。</p>
<p>这样，每个角色各司其职，路由器肩上的任务轻了，即使是油管 4K 也能轻松跑满网速了，而旁路由（树莓派）也结束了它吃灰的命运。由此资源的充分利用，一举两得。</p>
<p>在接下来的文章中，我们将在 Docker 容器中运行 OpenWrt，并通过设置，让 Docker 容器中的 OpenWrt 网关接管路由器自身的网关，减轻路由器的负担，同时，由于网关被 OpenWrt 接管，所以 OpenWrt 中的大部分应用都是可用的，比如酸酸乳，V2ray，去广告等。做个不恰当的比喻， OpenWrt 网关接管路由器自身的网关后，你可以理解为路由器是 OpenWrt 的一块外置网卡。</p>
<h3 id="镜像介绍">镜像介绍</h3>
<p>小苏为大家提供的 OpenWrt 镜像所用系统为基于 Lean 大源码编译的 32位/ IPV4 Only 固件，基本功能与之前的自编译固件相同，并且 Docker 镜像将跟随自编译固件的更新而更新。自编译固件的详细介绍请见：<br>
<a href="https://mlapp.cn/369.html">https://mlapp.cn/369.html</a></p>
<p>但值得注意的是，Docker 固件没有无线及无线相关功能。在以后的文章中，小苏将给大家分享 OpenWrt 镜像的制作步骤，敬请期待~（Q：喂！你挖的坑还不够多吗？A：咕咕咕！）。</p>
<h3 id="重要说明">重要说明</h3>
<p>1.<strong>此教程中提到的 Docker 镜像只适用于树莓派 2B/3B/3B+/4B，在其他设备上理论上不能正常使用</strong>。但文中所述内容对其他设备应该有参考意义。</p>
<p>2.在 Docker 中运行 OpenWrt ，树莓派将工作在旁路网关模式下，在这种工作模式下，树莓派的板载无线网卡不会工作（同时在 OpenWrt 的控制面板中也找不到有关 WIFI 的设置）。所以，需要将树莓派与路由器通过网线连接来使用。</p>
<h3 id="前期准备">前期准备</h3>
<p>既然需要在 Docker 中运行 OpenWrt ，那么首先需要在树莓派的现有系统上安装 Docker，在不同发行版上安装 Docker 的教程有很多，大家可以自行在搜索引擎中搜索相关内容以完成 Docker 的安装。</p>
<p>如果你的设备是 3B/3B+/4B，小苏推荐使用“树莓派爱好者基地”编译的 64 位 Debian，此版本 Debian 可以充分发挥 64 位 CPU 的性能，同时默认开启 Docker，KVM 等功能，其中，Docker 功能开箱即用，非常方便。</p>
<p>如果你的设备是树莓派2B，那么你可能需要在其他发行版上手动安装 Docker 了，但是小苏提供的 Docker 镜像是支持 2B~4B 设备的，换句话说，只要在其他发行版上成功安装了 Docker，也是可以用我提供的 OpenWrt 镜像的。</p>
<p>为了方便叙述以及为大家提供一个参考的宿主机环境，下文内容基于“树莓派爱好者基地”编译的 64 位 Debian。当然，如果你在你使用的发行版上安装了 Docker，步骤是一样的。</p>
<p>“树莓派爱好者基地”专版64位 Debian 功能介绍（内含下载链接）：</p>
<p><a href="https://github.com/openfans-community-offical/Debian-Pi-Aarch64/blob/master/README_zh.md">https://github.com/openfans-community-offical/Debian-Pi-Aarch64</a></p>
<p>下载时推荐选择“无桌面基础系统加强版”（如下图），如果你有图形界面需求，也可以选择带图形界面的其他版本镜像。</p>
<figure data-type="image" tabindex="1"><img src="https://imcm.xyz/post-images/1591772689336.png" alt="" loading="lazy"></figure>
<p>下载镜像烧写到树莓派的 SD 卡并上电开机后，系统会自动完成扩展 SD 卡空间的操作，这个过程大约需要3~5分钟（期间会重启几次）。估摸着时间差不多以后，用网线将树莓派的板载网口与路由器的 Lan 口连接，之后连接树莓派的 SSH：</p>
<p>用户名：pi<br>
密码：raspberry</p>
<p>准备工作到此结束。</p>
<h3 id="步骤开始">步骤开始</h3>
<p>成功登陆到树莓派的 SSH 后，在拉取镜像之前，我们还需要进行一些额外的工作：</p>
<ol>
<li>
<h4 id="打开网卡混杂模式">打开网卡混杂模式</h4>
</li>
</ol>
<pre><code class="language-shell">sudo ip link set eth0 promisc on
</code></pre>
<ol start="2">
<li>
<h4 id="创建网络须结合实际网络情况不能照抄命令">创建网络(须结合实际网络情况，不能照抄命令)</h4>
</li>
</ol>
<pre><code class="language-shell">docker network create -d macvlan --subnet=192.168.123.0/24 --gateway=192.168.123.1 -o parent=eth0 macnet
</code></pre>
<p>这一条命令需要根据树莓派所处的网络环境来做修改，可以使用 sudo ifconfig命令来查看树莓派 eth0 网卡获得的 IP 地址，如果树莓派获得的 IP 地址为 192.168.2.154，那么说明树莓派处在 192.168.2.x网段，相应的，命令中的192.168.123.0和192.168.123.1需要被替换成 192.168.2.0和192.168.2.1：</p>
<pre><code class="language-shell">docker network create -d macvlan --subnet=192.168.2.0/24 --gateway=192.168.2.1 -o parent=eth0 macnet
</code></pre>
<p>此时，我们使用 docker network ls命令可以看到网络macnet已建立成功：</p>
<pre><code class="language-shell">$ docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
10e676133746        bridge              bridge              local
f5308b94e8fa        host                host                local
16745ea66852        macnet              macvlan             local
5e72e41ea02a        none                null                local
</code></pre>
<ol start="3">
<li>
<h4 id="拉取镜像">拉取镜像</h4>
</li>
</ol>
<p>若身处国内，为提高拉取速度，请拉取阿里云仓库中的镜像：</p>
<pre><code class="language-shell">docker pull registry.cn-shanghai.aliyuncs.com/suling/openwrt:latest
</code></pre>
<p>同时小苏也提供存放在 Docker 官方仓库 中的镜像：</p>
<pre><code class="language-shell">docker pull sulinggg/openwrt:latest
</code></pre>
<p>镜像拉取完成后，我们可以执行docker images命令查看现存镜像：</p>
<pre><code class="language-shell">$ docker images
REPOSITORY                                              TAG                 IMAGE ID            CREATED             SIZE
registry.cn-shanghai.aliyuncs.com/suling/openwrt        latest              4f4bc5dca2d9        3 hours ago         112MB
</code></pre>
<p>可见，镜像已成功拉取到本地。</p>
<ol start="4">
<li>
<h4 id="创建并启动容器">创建并启动容器</h4>
</li>
</ol>
<pre><code class="language-shell">docker run --restart always --name openwrt -d --network macnet --privileged registry.cn-shanghai.aliyuncs.com/suling/openwrt:latest /sbin/init
</code></pre>
<p>其中：<br>
--restart always参数表示容器退出时始终重启，使服务尽量保持始终可用；<br>
--name openwrt参数定义了容器的名称；<br>
-d参数定义使容器运行在 Daemon 模式；<br>
--network macnet参数定义将容器加入 maxnet网络；<br>
--privileged 参数定义容器运行在特权模式下；<br>
registry.cn-shanghai.aliyuncs.com/suling/openwrt:latest为 Docker 镜像名，因容器托管在阿里云 Docker 镜像仓库内，所以在镜像名中含有阿里云仓库信息；<br>
/sbin/init定义容器启动后执行的命令。<br>
启动容器后，我们可以使用 docker ps -a命令查看当前运行的容器：</p>
<pre><code class="language-shell">$ docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
a26cee7cade6        openwrt:latest      &quot;/sbin/init&quot;        3 hours ago         Up 3 hours                              openwrt
</code></pre>
<p>若容器运行信息STATUS列为 UP状态，则说明容器运行正常。</p>
<ol start="5">
<li>
<h4 id="进入容器并修改相关参数">进入容器并修改相关参数</h4>
</li>
</ol>
<p>(须结合实际网络情况，不能照抄配置)</p>
<pre><code class="language-shell">docker exec -it openwrt bash
</code></pre>
<p>其中：<br>
openwrt为容器名称；<br>
bash为进入容器后执行的命令。<br>
执行此命令后我们便进入 OpenWrt 的命令行界面，首先，我们需要编辑 OpenWrt 的网络配置文件：</p>
<pre><code class="language-shell">vim /etc/config/network
</code></pre>
<p>我们需要更改 Lan 口设置：</p>
<pre><code class="language-shell">config interface 'lan'
        option type 'bridge'
        option ifname 'eth0'
        option proto 'static'
        option ipaddr '192.168.123.100'
        option netmask '255.255.255.0'
        option ip6assign '60'
        option gateway '192.168.123.1'
        option broadcast '192.168.123.255'
        option dns '192.168.123.1'
</code></pre>
<p>其中：<br>
所有的 192.168.123.x 需要根据树莓派所处网段修改，option gateway和option dns填写路由器的 IP，若树莓派获得的 IP 为 192.168.2.154，路由器 IP 为192.168.2.1，则需要这样修改：</p>
<pre><code class="language-shell">config interface 'lan'
        option type 'bridge'
        option ifname 'eth0'
        option proto 'static'
        option ipaddr '192.168.2.100'
        option netmask '255.255.255.0'
        option ip6assign '60'
        option gateway '192.168.2.1'
        option broadcast '192.168.2.255'
        option dns '192.168.2.1'
</code></pre>
<p>option ipaddr 项目定义了 OpenWrt 的 IP 地址，在完成网段设置后，IP最后一段可根据自己的爱好修改（前提是符合规则且不和现有已分配 IP 冲突）。</p>
<ol start="6">
<li>
<h4 id="重启网络">重启网络</h4>
</li>
</ol>
<pre><code class="language-shell">/etc/init.d/network restart
</code></pre>
<ol start="7">
<li>
<h4 id="进入控制面板">进入控制面板</h4>
</li>
</ol>
<p>在浏览器中输入第 5 步option ipaddr 项目中的 IP 进入 Luci 控制面板，若option ipaddr 的参数为 192.168.123.100，则可以在浏览器输入 http://192.168.123.100进入控制面板。</p>
<p>用户名：root<br>
密码：password</p>
<ol start="8">
<li>
<h4 id="关闭-dhcp-服务">关闭 DHCP 服务</h4>
</li>
</ol>
<p>在 “网络 - 接口 - Lan - 修改” 界面中，勾选下方的 “忽略此接口（不在此接口提供 DHCP 服务）”，并“保存&amp;应用”。<br>
<img src="https://imcm.xyz/post-images/1591772717735.png" alt="" loading="lazy"></p>
<ol start="9">
<li>
<h4 id="主路由-dhcp-设置">主路由 DHCP 设置</h4>
</li>
</ol>
<p>进入路由器后台中，将主路由的 DHCP 的默认网关和 DNS 服务器设置为第 5 步中option ipaddr 项目中的 IP。<br>
<img src="https://imcm.xyz/post-images/1591772738952.png" alt="" loading="lazy"></p>
<ol start="10">
<li>
<h4 id="重新连接路由器">重新连接路由器</h4>
</li>
</ol>
<p>完成以上操作后，断开设备（如手机，电脑）与路由器的连接，重新连接路由器，连接路由器的设备将获取到我们设置到的 IP。</p>
<h3 id="其他修复">其他修复</h3>
<ol>
<li>
<h4 id="关闭-wlan-硬件加速">关闭 WLAN 硬件加速</h4>
</li>
</ol>
<p>设置旁路路由后，若出现访问国内网站网速慢，不稳定的情况（多见于 Pandavan 及其改版固件，如华硕老毛子固件），请在路由器的控制面板中关闭有关 WLAN 的硬件加速，比如选择“Offload TCP/UDP for LAN”（若未出现此现象请忽略）：<br>
<img src="https://imcm.xyz/post-images/1591772753376.png" alt="" loading="lazy"></p>
<ol start="2">
<li>
<h4 id="宿主机网络修复">宿主机网络修复</h4>
</li>
</ol>
<p>OpenWrt 容器运行后，宿主机内可能无法正常连接外部网络，需要修改宿主机的 /etc/network/interfaces 文件以修复：</p>
<p><strong>(须结合实际网络情况，不能照抄配置)</strong></p>
<pre><code class="language-shell">cp /etc/network/interfaces /etc/network/interfaces.bak # 备份文件
vim /etc/network/interfaces # 使用 vim 编辑文件
</code></pre>
<p>以“树莓派爱好者基地”64 位 Debian 为例，向文件末尾添加：</p>
<pre><code class="language-shell">auto eth0
iface eth0 inet manual

auto macvlan
iface macvlan inet static
  address 192.168.123.200
  netmask 255.255.255.0
  gateway 192.168.123.1
  dns-nameservers 192.168.123.1
  pre-up ip link add macvlan link eth0 type macvlan mode bridge
  post-down ip link del macvlan link eth0 type macvlan mode bridge
</code></pre>
<p>其中，所有的 192.168.123.x都需要按照树莓派所处网段更改，gateway和dns-nameservers填写路由器的 IP，若树莓派获得的 IP 为 192.168.2.154，路由器 IP 为192.168.2.1，则需要这样修改：</p>
<pre><code class="language-shell">auto eth0
iface eth0 inet manual

auto macvlan
iface macvlan inet static
  address 192.168.2.200
  netmask 255.255.255.0
  gateway 192.168.2.1
  dns-nameservers 192.168.2.1
  pre-up ip link add macvlan link eth0 type macvlan mode bridge
  post-down ip link del macvlan link eth0 type macvlan mode bridge
</code></pre>
<p>修改后重启树莓派，之后树莓派的局域网 IP 地址将会固定为/etc/network/interfaces文件中address参数中的地址。</p>
<ol start="3">
<li>
<h4 id="手动指定网关">手动指定网关</h4>
</li>
</ol>
<p>如果路由器固件不支持自定义 DHCP 服务的网关及 DNS 地址（常见于路由器官方固件），或者只希望局域网下的个别设备接入旁路网关时，须在接入设备上做以下配置：</p>
<h5 id="安卓">安卓：</h5>
<figure data-type="image" tabindex="2"><img src="https://imcm.xyz/post-images/1591772765001.png" alt="" loading="lazy"></figure>
<p>需要在安卓的 WIFI 设置内将 IP 获取方式更改为“静态”或“手动”，其中：<br>
“IP 地址”项目需要更改为网段内不冲突的地址；<br>
“网关”或“路由器”项目需要更改为旁路网关 IP 地址；<br>
“前缀长度”项目填写“24”；<br>
“DNS”项目需要更改为旁路网关 IP 地址（两个 DNS 输入框填写一个就可以）。</p>
<p>完成并提交设置后，关闭 WIFI 开关再打开，连接设置的 WIFI 热点，若当前网络参数为设定值，则证明设置成功。</p>
<h5 id="windows">Windows:</h5>
<figure data-type="image" tabindex="3"><img src="https://imcm.xyz/post-images/1591772774844.png" alt="" loading="lazy"></figure>
<p>在无线热点的“属性”界面下，点击 “IP 设置 - 编辑”按钮，在弹出框中更改 IP 分配模式为“手动”，打开 IPV4 的开关，根据所处网段及上文安卓的相关设置填写相关参数即可。</p>
<h3 id="注意事项">注意事项</h3>
<ol>
<li>文章所述方案适用于光猫或路由器已完成宽带拨号的网络环境，未测试也不推荐使用 Docker 内的 OpenWrt 进行宽带拨号；</li>
<li>OpenWrt 容器跟随树莓派系统启动，无需手动干预；</li>
<li>由于容器内系统内核共享宿主机内核，所以在 Luci 面板的 “内核版本”项与宿主机内核版本一致；</li>
<li>在对容器进行停止或删除操作时，树莓派可能会发生卡顿现象，SSH 可能会断开，1~2 分钟后会恢复正常，目前原因不明；</li>
<li>经测试，发现 Adblock 不工作，UnblockNeteaseMusic 需要自行设置代理，除此之外容器中的 OpenWrt 多数应用工作正常，如有发现不能正常工作的应用请评论反馈~</li>
</ol>
<p>参考资料</p>
<ol>
<li><a href="https://github.com/coolsnowwolf/lede">OpenWrt By Lean · coolsnowwolf/lede - GitHub</a></li>
<li><a href="https://www.right.com.cn/forum/thread-588747-1-1.html">【小狮子编译贴】抛砖引玉，为打造N1路由神器 - 恩山无线论坛</a></li>
<li><a href="https://www.right.com.cn/forum/thread-1048535-1-1.html">docker openwrt 踩坑的几个小问题解决过程分享 - 恩山无线论坛</a></li>
<li><a href="https://www.right.com.cn/forum/thread-506510-1-1.html">N1刷入LEAN OPENWRT做旁路网关，导致访问国内网站卡顿 - 恩山无线论坛</a></li>
</ol>

                          </div>
                        </div>
                        <div class="layout-post-social">
                          <div class="item reader">
                            <div id="/post/docker-openwrt/" class="leancloud-visitors view"
                              data-flag-title="在Docker 中运行 OpenWrt 旁路网关">
                              <span class="post-meta-item-text">阅读 </span>
                              <span class="leancloud-visitors-count"></span>
                            </div>
                          </div>
                        </div>

                        <div class="layout-post-navigation">
                          <div class="navigation-list">
                            
                            <div class="post-card row">
                              
                              <div class="card-content col-8 col-md-9">
                                <div class="card-body">
                                  <div class="header">
                                    <a href="https://imcm.xyz/gyp-no-xcode/" class="title">
                                      <h4>gyp: No Xcode or CLT version detected!</h4>
                                    </a>
                                  </div>
                                  <div class="inner d-none d-sm-block">
                                    <div class="abstract">
                                      <p>npm install 安装依赖包报如下错误</p>

                                    </div>
                                  </div>
                                </div>
                                <div class="card-footer">
                                  <div class="item"><span>上一篇</span></div>
                                  <div class="item">2020-06-17</div>
                                </div>
                              </div>
                              <div class="card-thumb col-4 col-md-3">
                                <div class="thumb">
                                  <a href="https://imcm.xyz/gyp-no-xcode/"
                                    style="background-image: url('https://imcm.xyz/post-images/gyp-no-xcode.png');"></a>
                                </div>
                              </div>
                              
                            </div>

                            <div class="post-card row">
                              
                              <div class="card-content col-8 col-md-9">
                                <div class="card-body">
                                  <div class="header">
                                    <a href="https://imcm.xyz/chown-git/" class="title">
                                      <h4>Git 忽略文件目录权限或文件拥有者的改变</h4>
                                    </a>
                                  </div>
                                  <div class="inner d-none d-sm-block">
                                    <div class="abstract">
                                      <p>git 中可以加入忽略文件权限的配置，在 git 根目录运行如下命令：</p>

                                    </div>
                                  </div>
                                </div>
                                <div class="card-footer">
                                  <div class="item"><span>下一篇</span></div>
                                  <div class="item">2020-06-13</div>
                                </div>
                              </div>
                              <div class="card-thumb col-4 col-md-3">
                                <div class="thumb">
                                  <a href="https://imcm.xyz/chown-git/"
                                    style="background-image: url('https://imcm.xyz/post-images/chown-git.svg');"></a>
                                </div>
                              </div>
                              
                            </div>

                            
                          </div>
                        </div>

                        <div class="layout-comments" id="comments">
                          
                            
                        </div>
                      </div>
                    </div>

                    <div class="col-12 col-lg-2 d-none d-lg-block">
                      <div class="layout-post-sidebar">
                        <div class="layout-sidebar-item">
                          <ul class="markdownIt-TOC">
<li>
<ul>
<li>
<ul>
<li><a href="#%E5%9C%BA%E6%99%AF1">场景1</a></li>
<li><a href="#%E5%9C%BA%E6%99%AF2">场景2</a></li>
<li><a href="#%E6%97%81%E8%B7%AF%E7%BD%91%E5%85%B3">旁路网关</a></li>
<li><a href="#%E9%95%9C%E5%83%8F%E4%BB%8B%E7%BB%8D">镜像介绍</a></li>
<li><a href="#%E9%87%8D%E8%A6%81%E8%AF%B4%E6%98%8E">重要说明</a></li>
<li><a href="#%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87">前期准备</a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4%E5%BC%80%E5%A7%8B">步骤开始</a>
<ul>
<li><a href="#%E6%89%93%E5%BC%80%E7%BD%91%E5%8D%A1%E6%B7%B7%E6%9D%82%E6%A8%A1%E5%BC%8F">打开网卡混杂模式</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C%E9%A1%BB%E7%BB%93%E5%90%88%E5%AE%9E%E9%99%85%E7%BD%91%E7%BB%9C%E6%83%85%E5%86%B5%E4%B8%8D%E8%83%BD%E7%85%A7%E6%8A%84%E5%91%BD%E4%BB%A4">创建网络(须结合实际网络情况，不能照抄命令)</a></li>
<li><a href="#%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F">拉取镜像</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8">创建并启动容器</a></li>
<li><a href="#%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8%E5%B9%B6%E4%BF%AE%E6%94%B9%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0">进入容器并修改相关参数</a></li>
<li><a href="#%E9%87%8D%E5%90%AF%E7%BD%91%E7%BB%9C">重启网络</a></li>
<li><a href="#%E8%BF%9B%E5%85%A5%E6%8E%A7%E5%88%B6%E9%9D%A2%E6%9D%BF">进入控制面板</a></li>
<li><a href="#%E5%85%B3%E9%97%AD-dhcp-%E6%9C%8D%E5%8A%A1">关闭 DHCP 服务</a></li>
<li><a href="#%E4%B8%BB%E8%B7%AF%E7%94%B1-dhcp-%E8%AE%BE%E7%BD%AE">主路由 DHCP 设置</a></li>
<li><a href="#%E9%87%8D%E6%96%B0%E8%BF%9E%E6%8E%A5%E8%B7%AF%E7%94%B1%E5%99%A8">重新连接路由器</a></li>
</ul>
</li>
<li><a href="#%E5%85%B6%E4%BB%96%E4%BF%AE%E5%A4%8D">其他修复</a>
<ul>
<li><a href="#%E5%85%B3%E9%97%AD-wlan-%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F">关闭 WLAN 硬件加速</a></li>
<li><a href="#%E5%AE%BF%E4%B8%BB%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BF%AE%E5%A4%8D">宿主机网络修复</a></li>
<li><a href="#%E6%89%8B%E5%8A%A8%E6%8C%87%E5%AE%9A%E7%BD%91%E5%85%B3">手动指定网关</a>
<ul>
<li><a href="#%E5%AE%89%E5%8D%93">安卓：</a></li>
<li><a href="#windows">Windows:</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">注意事项</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="layout-totop d-none"><i class="fa fa-angle-up" aria-hidden="true"></i></div>

    	<div class="layout-footer">

		<div class="container">
			<div class="row justify-content-lg-center">
				<div class="col-12 col-lg-9">
					<div class="footer">
						<div class="row">
							<div class="col-12 col-md-9">
								<div class="footer-copy">
									
									Copyright 2020 imcm.xyz. All Rights Reserved.
|
<a href="http://beian.miit.gov.cn" target="_blank">粤ICP备16038460号
</a>
|
<span id="jinrishici-sentence">正在加载今日诗词....</span>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
									<div class="footer-icp d-none d-sm-inline-block">
										<span class="px-2">⋅</span>
										
									</div>
								</div>
							</div>
							<div class="col-sm-3 d-none d-md-block">
								<div class="footer-links">
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
									
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>

	<script type="text/javascript" src='https://imcm.xyz/media/scripts/main.js'></script>
	
	<script>
		var _hmt = _hmt || [];
		(function () {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?&lt;script&gt; var _hmt = _hmt || []; (function() {   var hm = document.createElement(&#34;script&#34;);   hm.src = &#34;https://hm.baidu.com/hm.js?b458c042ab39991f105ed855cfacfcd0&#34;;   var s = document.getElementsByTagName(&#34;script&#34;)[0];    s.parentNode.insertBefore(hm, s); })(); &lt;/script&gt;";
			var s = document.getElementsByTagName("script")[0];
			s.parentNode.insertBefore(hm, s);
		})();
	</script>
	

  </div>
</body>

</html>